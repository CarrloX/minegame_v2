<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Texturas - Minecraft Clone</title>
    <!-- Cargar Three.js desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.179.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.179.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #87CEEB;
            font-family: Arial, sans-serif;
        }
        canvas { 
            display: block; 
            width: 100%; 
            height: 100%;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background-color: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            max-width: 400px;
            font-size: 14px;
            z-index: 100;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            background-color: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
        button {
            margin: 2px;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="info">Inicializando prueba de texturas...</div>
    <div id="controls">
        <div>
            <button id="changeTexture">Cambiar Textura</button>
            <button id="toggleWireframe">Mostrar Malla</button>
        </div>
    </div>

    <script>
        // Verificar que Three.js esté cargado
        if (!window.THREE) {
            document.getElementById('info').innerHTML = 
                '<p style="color: red;">Error: No se pudo cargar Three.js. Verifica tu conexión a internet.</p>';
            throw new Error('Three.js no se cargó correctamente');
        }

        console.log('Three.js versión:', THREE.REVISION);
        
        // Inicializar la escena
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        
        // Configurar cámara
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(2, 2, 2);
        
        // Configurar renderizador
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);
        
        // Controles de órbita
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        
        // Configurar luces
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);
        
        // Variables globales
        let currentCube = null;
        let currentTexture = 0;
        const texturePaths = [
            'assets/textures/atlas.svg',
            'https://threejs.org/examples/textures/uv_grid_opengl.jpg'
        ];
        
        // Función para cargar textura
        function loadTexture(path, callback) {
            const loader = new THREE.TextureLoader();
            loader.load(
                path,
                function(texture) {
                    texture.magFilter = THREE.NearestFilter;
                    texture.minFilter = THREE.NearestFilter;
                    callback(null, texture);
                },
                undefined,
                function(error) {
                    console.error('Error al cargar la textura:', error);
                    callback(error);
                }
            );
        }
        
        // Función para crear un cubo con textura
        function createCube(texturePath) {
            const infoDiv = document.getElementById('info');
            
            infoDiv.innerHTML = `Cargando textura: ${texturePath.split('/').pop()}...`;
            
            loadTexture(texturePath, function(error, texture) {
                if (error) {
                    infoDiv.innerHTML += `<p style="color: red;">Error: ${error.message || 'No se pudo cargar la textura'}</p>`;
                    return;
                }
                
                infoDiv.innerHTML = `
                    <p>✅ Textura cargada: ${texturePath.split('/').pop()}</p>
                    <p>Dimensiones: ${texture.image ? texture.image.width + 'x' + texture.image.height : 'N/A'}</p>
                    <p>Formato: ${texturePath.endsWith('.svg') ? 'SVG' : 'Imagen'}</p>
                `;
                
                // Crear geometría y material
                const geometry = new THREE.BoxGeometry(1, 1, 1);
                const material = new THREE.MeshStandardMaterial({
                    map: texture,
                    side: THREE.DoubleSide,
                    flatShading: true,
                    transparent: true,
                    alphaTest: 0.1
                });
                
                // Crear malla
                const cube = new THREE.Mesh(geometry, material);
                
                // Eliminar cubo anterior si existe
                if (currentCube) {
                    scene.remove(currentCube);
                    currentCube.geometry.dispose();
                    currentCube.material.dispose();
                }
                
                // Añadir nuevo cubo a la escena
                scene.add(cube);
                currentCube = cube;
                
                // Añadir ejes de referencia
                addAxesHelper();
            });
        }
        
        // Función para añadir ejes de referencia
        function addAxesHelper() {
            // Eliminar ayudantes anteriores
            scene.children = scene.children.filter(function(child) {
                return !(child instanceof THREE.AxesHelper);
            });
            
            // Añadir ejes de referencia
            const axesHelper = new THREE.AxesHelper(2);
            scene.add(axesHelper);
        }
        
        // Función para alternar la visualización de la malla
        function toggleWireframe() {
            if (currentCube) {
                currentCube.material.wireframe = !currentCube.material.wireframe;
            }
        }
        
        // Función para cambiar a la siguiente textura
        function nextTexture() {
            currentTexture = (currentTexture + 1) % texturePaths.length;
            createCube(texturePaths[currentTexture]);
        }
        
        // Configurar controles de la interfaz
        document.getElementById('toggleWireframe').addEventListener('click', toggleWireframe);
        document.getElementById('changeTexture').addEventListener('click', nextTexture);
        
        // Manejar redimensionamiento de la ventana
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Función de animación
        function animate() {
            requestAnimationFrame(animate);
            
            // Rotar el cubo si existe
            if (currentCube) {
                currentCube.rotation.x += 0.005;
                currentCube.rotation.y += 0.01;
            }
            
            // Actualizar controles
            controls.update();
            
            // Renderizar la escena
            renderer.render(scene, camera);
        }
        
        // Iniciar la aplicación
        createCube(texturePaths[0]);
        animate();
        
        // Mostrar mensaje de ayuda
        console.log('Prueba de texturas iniciada. Usa los controles en la esquina inferior izquierda.');
    </script>
</body>
</html>
